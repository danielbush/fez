backend:
  environment:
    - APP_ENVIRONMENT=development
    - XDEBUG_CONFIG=idekey=fez
    - PHP_IDE_CONFIG=serverName=dev-fez.library.uq.edu.au
  image: uqlibrary/docker-nginx:latest
  links:
    - fezdb
    - fedora
    - fedoradb
    - solr
  ports:
    - "8080:80"
    - "9000:9000"
  privileged: true
  volumes:
    - ../../:/var/app/current
    - /data/docker/fez/fedora:/espace/data
    - logs/backend/nginx:/var/log/nginx
    - logs/backend/fpm:/var/log/php-fpm

fedora:
  image: uqlibrary/docker-fedoracommons:latest
  links:
    - fedoradb
  ports:
    - "10081:10081"
  privileged: true
  volumes:
    - /data/docker/fez/fedora:/espace/data
    - etc/fedora/tomcat-users.xml:/opt/fedora/tomcat/conf/tomcat-users.xml
    - etc/fedora/fedora.fcfg:/opt/fedora/server/config/fedora.fcfg
    - etc/fedora/fedora-users.xml:/opt/fedora/server/config/fedora-users.xml
    - logs/fedora_tomcat:/opt/fedora/tomcat/logs
    - logs/fedora:/opt/fedora/server/logs

fezdb:
  environment:
    - MYSQL_ROOT_PASSWORD=development
    - MYSQL_USER=fez
    - MYSQL_PASSWORD=fez
    - MYSQL_DATABASE=fez
  image: mysql:latest
  ports:
    - "3306:3306"
  privileged: true
  volumes:
    - /data/docker/fez/mysql:/var/lib/mysql
    - etc/mysql/default.cnf:/etc/mysql/conf.d/default.cnf

fedoradb:
  environment:
    - MYSQL_ROOT_PASSWORD=development
    - MYSQL_USER=fedoraAdmin
    - MYSQL_PASSWORD=fedoraAdmin
    - MYSQL_DATABASE=fedora3
  image: mysql:latest
  ports:
    - "3307:3306"
  privileged: true
  volumes:
    - /data/docker/fez/mysql_fedora:/var/lib/mysql
    - etc/mysql/default.cnf:/etc/mysql/conf.d/default.cnf

solr:
  image: makuk66/docker-solr:4.10.4
  ports:
    - "8983:8983"
  privileged: true
  volumes:
    - /data/docker/fez/solr:/opt/solr/example/solr/collection1/data
    - etc/solr/schema.xml:/opt/solr/example/solr/collection1/conf/schema.xml
    - etc/solr/solrconfig.xml:/opt/solr/example/solr/collection1/conf/solrconfig.xml
    - logs/solr:/opt/solr/example/logs
