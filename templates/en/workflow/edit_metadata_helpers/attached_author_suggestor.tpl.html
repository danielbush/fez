
<br />
<table>
   <tr>
       <td>
           <span class="default"><b>{$attached_xsdmf.xsdmf_title}:</b></span>
            {assign var="attached_field_id" value="xsd_display_fields_"|cat:$attached_xsdmf_id|cat:"_"|cat:$loop_num}
            <select class="default" id="{$attached_field_id}" name="{$attached_field_id}">	
               <option value="0">(none)</option>

               {if ($details[$temp_fld_id][$loop_num] != "" && $details[$attached_xsdmf_id][$loop_num] != 0)}
            	   {if is_array($details[$attached_xsdmf_id])}
            		 {if $details[$attached_xsdmf_id][$loop_num][0] != ""}
            		   {assign var="author_id" value=$details[$attached_xsdmf_id][$loop_num]}
            		   <option value="{$author_id[0]}" selected>{$author_id[1]} ({$author_id[0]}) ({$author_id[2]})</option>
            		  {/if}
            	   {/if}
            	{/if}
            </select>
    	</td>
    	<td>
            <!-- Google suggest style selection -->
            {* IE HACK: We want the suggest dropdown to be on top of any other auto-suggest controls which appear below it *}
            {* smarty.section.i.index is used incase this suggest control is used by more than 1 element ie. Author and Editor *}
			<div id="authorsuggest" style="width:15em;height:2em;position:relative;z-index:{math equation="2000 - x - y" y=$loop_num x=$smarty.section.i.index};">
			  <div id="{$attached_field_id}_container" style="position:absolute;top:1.6em;"></div>
            	<input id="{$attached_field_id}_lookup" type="text">
            </div>
        </td>
    </tr>
</table>
    
    {literal}
    <script type="text/javascript">
    
    // Instantiate first JS Array DataSource
    var myServer = "{/literal}{$rel_url}{literal}author_suggest_proxy.php";
    var mySchema = ["Result","name"];
    var myDataSource = new YAHOO.widget.DS_XHR(myServer, mySchema);
    
    // Instantiate first AutoComplete
    this.oAutoComp{/literal}{$loop_num}{literal} = new YAHOO.widget.AutoComplete('{/literal}{$attached_field_id}_lookup','{$attached_field_id}_container{literal}', myDataSource);
    this.oAutoComp{/literal}{$loop_num}{literal}.maxResultsDisplayed = 60; 
    this.oAutoComp{/literal}{$loop_num}{literal}.formatResult = function(oResultItem, sQuery) {
        var usernameTxt = "";
        
        if( oResultItem[1].username != "" && oResultItem[1].username != null )
        {
            usernameTxt = ' (' +  oResultItem[1].username + ')'
        }
        idTxt = ' (' +  oResultItem[1].id + ')'
        return oResultItem[1].name + idTxt + usernameTxt;
    };
    
    this.oAutoComp{/literal}{$loop_num}{literal}.registerControls(document.getElementById('xsd_display_fields_{/literal}{$xsd_display_fields[i].xsdmf_id}_{$loop_num}'), document.getElementById('{$attached_field_id}'){literal});
    
    this.oAutoComp{/literal}{$loop_num}{literal}.textboxFocusEvent.subscribe(function(){
        var sInputValue = YAHOO.util.Dom.get('{/literal}{$attached_field_id}_lookup{literal}').value;
        if(sInputValue.length === 0) {
            var oSelf = this;
            setTimeout(function(){oSelf.sendQuery(sInputValue);},0);
        }
    });
    
    this.oAutoComp{/literal}{$loop_num}{literal}.itemSelectEvent.subscribe(function(){
        javascript:unhideRow('xsd_display_fields_{/literal}{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}{literal}');
    });
    
    </script>
    
    <style type="text/css">
    #{/literal}{$attached_field_id}{literal}_container {
	    position:absolute;
	    top:1.6em; 
	    width:100%;
    }

    #{/literal}{$attached_field_id}{literal}_container .yui-ac-content {
	    position:relative;
        max-height:11em;
        /* height: 150px; */
        width: 250px;
        overflow:auto;
        overflow-x:hidden; /* scrolling */
        _height:11em; /* ie6 */
        z-index:9071;
    }
    </style>
    
    {/literal}

{if $attached_xsdmf.xsdmf_attached_xsdmf_id != ""}
	{assign var="attached_xsdmf_id" value=$attached_xsdmf.xsdmf_attached_xsdmf_id}
	{section name='aas' loop=$xsd_display_fields}{if $xsd_display_fields[aas].xsdmf_id == $attached_xsdmf_id}{assign var="attached_xsdmf" value=$xsd_display_fields[aas]}{/if}{/section}
	{assign var="attached_field_name" value="xsd_display_fields_"|cat:$attached_xsdmf_id|cat:"_"|cat:$loop_num}						
	{include file='workflow/edit_metadata_helpers/attached_'|cat:$attached_xsdmf.xsdmf_html_input|cat:'.tpl.html'}
{/if}