{literal}
<script language="JavaScript">
<!--
function purgeDatastream(ds_id)
{
    if (!confirm('This action will permanently delete the selected datastream.')) {
        return false;
    } else {
        var features = 'width=420,height=200,top=30,left=30,resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
        var popupWin = window.open('{/literal}{$rel_url}{literal}popup.php?cat=purge_datastream&pid={/literal}{$pid}{literal}&dsID=' + ds_id, '_popup', features);
        popupWin.focus();
    }
}
//-->
</script>
{/literal}


{if $new_record_id != "" and $smarty.post.report_stays != "yes"}
<table width="500" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td class="default">
            <b>Thank you, the new record was created successfully. Please choose 
            from one of the options below:</b>
            <ul>
              <li><a href="view.php?id={$new_record_id}" class="link">Open the Record Details Page</a></li>
              <li><a href="list.php" class="link">Open the Record Listing Page</a></li>
              {if $app_setup.support_email == 'enabled' and $current_role > $roles.viewer}
              <li><a href="emails.php" class="link">Open the Emails Listing Page</a></li>
              {/if}
              <li><a href="new.php" class="link">Report a New Record</a></li>
            </ul>
            <b>Otherwise, you will be automatically redirected to the Record Details Page in 5 seconds.</b>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
{literal}
<script language="JavaScript">
<!--
setTimeout('openDetailPage()', 5000);
function openDetailPage()
{
{/literal}
    window.location.href = 'view.php?pid={$new_record_id}';
{literal}
}
//-->
</script>

{/literal}
{/if}
{literal}
<script language="JavaScript" src="{/literal}{$rel_url}{literal}js/dynCalendar.js"></script>
<script language="JavaScript" src="{/literal}{$rel_url}{literal}js/autosuggest.js"></script>
<script language="JavaScript" src="{/literal}{$rel_url}{literal}js/suggestions.js"></script>
<script language="JavaScript">
{/literal}{$najax_register}{literal}
<!--
var required_xsd_display_fields = new Array();
var xsd_display_fields = new Array();
function validateForm() {
{/literal}
{section name="i" loop=$xsd_display_fields}
{if $xsd_display_fields[i].xsdmf_html_input == 'contvocab_selector' && $xsd_display_fields[i].xsdmf_enabled == 1}
{literal}
//selectAllOptions(document.wfl_form1, 'xsd_display_fields_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}_1');
	var field = document.wfl_form1.xsd_display_fields_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}_1;
    for (var y = 0; y < field.options.length; y++) {
        field.options[y].selected = true;
    }
{/literal}
{/if}
{/section}
{literal}
checkRequiredFields(document.wfl_form1, required_xsd_display_fields);
}



{/literal}
{section name="i" loop=$xsd_display_fields}
{if $xsd_display_fields[i].xsdmf_html_input == 'date' && $xsd_display_fields[i].xsdmf_enabled == 1}
{literal}
function calendarCallback_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}(day, month, year) { selectDateField('xsd_display_fields[{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}]', day, month, year); }
function calendarCallback_xsd_display_fields_end{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}(day, month, year) { selectDateField('xsd_display_fields_end[{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}]', day, month, year); }
{/literal}
{elseif $xsd_display_fields[i].xsdmf_html_input == 'org_selector' && $xsd_display_fields[i].xsdmf_use_org_to_fill == 1}
{literal}
var dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal} = 0;
function showLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}()
{
	document.body.style.cursor = 'wait';
	document.getElementById('loading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}').style.display = 'block';
}

function hideLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}()
{
	document.body.style.cursor = '';
	document.getElementById('loading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}').style.display = 'none';
}
function selectOrgStructure_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}(f, field_name)
{
	if (dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal} > 0) {
	   return false;
	} 
	var field = document.wfl_form1.xsd_display_fields_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}_1;
	var selections = getSelectedItems(field);

	if (selections.length > 0) {
		dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}++;
//		document.getElementById('tr_org_id').style.display = '';
		showLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}();
		var obj = new SelectOrgStructure();
		obj.ongetSubListError = function() {
			removeAllOptions(f, '{/literal}xsd_display_fields[{$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}]{literal}');
			hideLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}();
			dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}--;
		}
		obj.setTimeout(10000);
		
		if ((IsNumeric(selections[0].value) == true) && (selections[0].value != '-1')) {
			obj.getSubList(selections[0].value, function(dt_list) {
					removeAllOptions(f, '{/literal}xsd_display_fields[{$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}]{literal}');
					addOptions(f, '{/literal}xsd_display_fields[{$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}]{literal}', dt_list);
					{/literal}{assign var="temp_select_id" value=$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}{literal}
//					selectOption(f, '{/literal}xsd_display_fields[{$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}]{literal}', {/literal}{$details[$temp_select_id]}{literal});
					hideLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}();
					dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}--;
					});		
		} else {
			removeAllOptions(f, '{/literal}xsd_display_fields[{$xsd_display_fields[i].xsdmf_org_fill_xsdmf_id}]{literal}');		
			hideLoading_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}();
			dt_load_state_{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}--;

		}

	}
}		
{/literal}
{/if}
{/section}
{literal}

function toggleDateFields(f, field_name)
{
    var checkbox = getFormElement(f, 'filter[' + field_name + ']');
    var filter_type = getFormElement(f, field_name + '[filter_type]');
    var month_field = getFormElement(f, field_name + '[Month]');
    var day_field = getFormElement(f, field_name + '[Day]');
    var year_field = getFormElement(f, field_name + '[Year]');
    var month_end_field = getFormElement(f, field_name + '_end[Month]');
    var day_end_field = getFormElement(f, field_name + '_end[Day]');
    var year_end_field = getFormElement(f, field_name + '_end[Year]');
    if (checkbox.checked) {
        var bool = false;
    } else {
        var bool = true;
    }
    filter_type.disabled = bool;
    month_field.disabled = bool;
    day_field.disabled = bool;
    year_field.disabled = bool;
    month_end_field.disabled = bool;
    day_end_field.disabled = bool;
    year_end_field.disabled = bool;
}
function checkDateFilterType(f, type_field)
{
    var option = getSelectedOption(f, type_field.name);
    var element_name = type_field.name.substring(0, type_field.name.indexOf('['));
    var element = getPageElement(element_name + 1);
    if ((option == 'between') && (!isElementVisible(element))) {
        toggleVisibility(element_name, false);
    } else if ((option != 'between') && (isElementVisible(element))) {
        toggleVisibility(element_name, false);
    }
}
function selectDateOptions(field_prefix, date_str)
{
    if (date_str.length != 10) {
        return false;
    } else {
        var year = date_str.substring(0, date_str.indexOf('-'));
        var month = date_str.substring(date_str.indexOf('-')+1, date_str.lastIndexOf('-'));
        var day = date_str.substring(date_str.lastIndexOf('-')+1);
        selectDateField(field_prefix, day, month, year);
    }
}
function selectDateField(field_name, day, month, year)
{
    selectOption(this.document.wfl_form1, field_name + '[Day]', day);
    selectOption(this.document.wfl_form1, field_name + '[Month]', month);
    selectOption(this.document.wfl_form1, field_name + '[Year]', year);
}
//-->
</script>
{/literal}

<table width="99%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">


<input type="hidden" name="cat" value="update_form">
<input type="hidden" name="xdis_id" value="{$xdis_id}">
<input type="hidden" name="sta_id" value="{$sta_id}">
<input type="hidden" name="pid" value="{$pid}">
<input type="hidden" name="id" value="{$id}">
{section name="i" loop=$xsd_display_fields}
	{if $xsd_display_fields[i].xsdmf_title == 'state'}
<input type="hidden" name="state" value="{$xsd_display_fields[i].xsdmf_static_text}">
	{/if}
{/section}
   <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="0" border="0">
        <tr>
          <td class="default_white" bgcolor="{$heading_color}">
            &nbsp;<img align="absmiddle" src="{$rel_url}images/edit_32.gif"><b>Edit {$xdis_title} Record</b>
          </td>
        </tr>
        {section name="i" loop=$xsd_display_fields}
		{assign var="temp_fld_id" value=$xsd_display_fields[i].xsdmf_id}
		{if ($xsd_display_fields[i].xsdmf_html_input != 'xsdmf_id_ref' and $xsd_display_fields[i].xsdmf_html_input != 'xsd_ref' and $xsd_display_fields[i].xsdmf_html_input != '')}
		  {if ((($xsd_display_fields[i].xsdmf_html_input == 'static' && $xsd_display_fields[i].xsdmf_show_in_view == 1 && $xsd_display_fields[i].xsdmf_static_text != '') && ($xsd_display_fields[i].xsdmf_show_in_view == 1)) || ($xsd_display_fields[i].xsdmf_html_input != 'static'))}
			  {if ((($xsd_display_fields[i].xsdmf_html_input == 'xsd_loop_subelement') && ($xsd_display_fields[i].xsdmf_show_in_view == 1)) || ($xsd_display_fields[i].xsdmf_html_input != 'xsd_loop_subelement')) && $xsd_display_fields[i].xsdmf_enabled == 1}
        <tr><td colspan="2" class="default">
	<table id="choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}" border="0" cellpadding="2" cellspacing="0" width="100%">
            {if $xsd_display_fields[i].xsdmf_required == 1 && $xsd_display_fields[i].xsdmf_enabled == 1}
            <script language="JavaScript">
            <!--
            xsd_display_fields[xsd_display_fields.length] = new Option('xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]{if $xsd_display_fields[i].xsdmf_html_input == 'multiple' || $xsd_display_fields[i].xsdmf_html_input == 'contvocab' || $xsd_display_fields[i].xsdmf_html_input == 'allcontvocab' || $xsd_display_fields[i].xsdmf_html_input == 'contvocab_selector' || $xsd_display_fields[i].xsdmf_multiple == 1}[]{/if}', '{$xsd_display_fields[i].xsdmf_title}');
            required_xsd_display_fields[required_xsd_display_fields.length] = new Option('xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]{if $xsd_display_fields[i].xsdmf_html_input == 'multiple'|| $xsd_display_fields[i].xsdmf_html_input == 'contvocab' || $xsd_display_fields[i].xsdmf_html_input == 'allcontvocab' || $xsd_display_fields[i].xsdmf_html_input == 'contvocab_selector' || $xsd_display_fields[i].xsdmf_multiple == 1}[]{/if}', {if $xsd_display_fields[i].xsdmf_html_input == 'multiple' || $xsd_display_fields[i].xsdmf_html_input == 'contvocab' || $xsd_display_fields[i].xsdmf_html_input == 'allcontvocab' || $xsd_display_fields[i].xsdmf_html_input == 'contvocab_selector'}'multiple'{elseif $xsd_display_fields[i].xsdmf_html_input == 'checkbox'}'checkbox'{elseif $xsd_display_fields[i].xsdmf_html_input == 'combo' || $xsd_display_fields[i].xsdmf_html_input == 'author_selector'}'combo'{else}'whitespace'{/if});
            //-->
            </script>
            {/if}

            {if $xsd_display_fields[i].xsdmf_html_input == 'file_input' && $xsd_display_fields[i].xsdmf_enabled == 1}
            <!-- File Input -->
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $loop_num != 1}style="display:none"{/if}>
						  <td width="200" bgcolor="{$cell_color}" class="default">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num}</b>{if $xsd_display_fields[i].xsdmf_required == 1} * {/if}<br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appears as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$value_color}">
						<input class="default" type="file" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" onKeyUp="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" maxlength="255" size="50">
							
						  {if $xsd_display_fields[i].xsdmf_attached_xsdmf_id != ""}
								{section name="a" loop=$xsd_display_fields}
									{assign var="temp_attached_xsdmf_id" value=$xsd_display_fields[a].xsdmf_id}
									{if $temp_attached_xsdmf_id == $xsd_display_fields[i].xsdmf_attached_xsdmf_id}
										{if $xsd_display_fields[a].xsdmf_html_input == 'text'}
											<br /> 
											<span class="default"><b>{$xsd_display_fields[a].xsdmf_title}:</b></span>
											{assign var="attached_field_id" value="xsd_display_fields_"|cat:$temp_attached_xsdmf_id|cat:"_"|cat:$loop_num}
											<input class="default" type="text" id="{$attached_field_id}" name="xsd_display_fields[{$xsd_display_fields[a].xsdmf_id}][]" value="{$details[$temp_fld_id][z]}"  maxlength="255" size="50">
										{elseif $xsd_display_fields[a].xsdmf_html_input == 'checkbox'}
											<input class="default" type="checkbox" id="xsd_display_fields_{$xsd_display_fields[a].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[a].xsdmf_id}][]" {if $details[$temp_fld_id][z] =='on'}checked{/if} onKeyUp="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[a].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[a].xsdmf_id}');" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[a].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[a].xsdmf_id}');">
												{include file="error_icon.tpl.html" field="xsd_display_fields["|cat:$xsd_display_fields[a].xsdmf_id|cat:"][]"}
												{if $xsd_display_fields[a].xsdmf_long_description != ""}
													<span class="default">{$xsd_display_fields[a].xsdmf_long_description}</span>
												{/if}
										{/if}
									{/if}
								{/section}
						  {/if}

						 </td>
						</tr>
					{/section}
				{else}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="200" bgcolor="{$cell_color}" class="default">
							<b>{$xsd_display_fields[i].xsdmf_title}{if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
						  </td>
						  <td bgcolor="{$value_color}">
						<input class="default" type="file" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]"  maxlength="255" size="50">
						  {if $xsd_display_fields[i].xsdmf_attached_xsdmf_id != ""}
								{section name="a" loop=$xsd_display_fields}
									{assign var="temp_attached_xsdmf_id" value=$xsd_display_fields[a].xsdmf_id}
								  	{if $xsd_display_fields[a].xsdmf_html_input == 'text' AND $temp_attached_xsdmf_id == $xsd_display_fields[i].xsdmf_attached_xsdmf_id}
										<br />
										<span class="default"><b>{$xsd_display_fields[a].xsdmf_title}:</b></span>
									    {assign var="attached_field_id" value="xsd_display_fields_"|cat:$temp_attached_xsdmf_id|cat:"_"|cat:$loop_num}
										<input class="default" type="text" id="{$attached_field_id}" name="xsd_display_fields[{$xsd_display_fields[a].xsdmf_id}][]" value="{$details[$temp_fld_id][z]}" onKeyUp="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" maxlength="255" size="50">
									{/if}
								{/section}
						  {/if}
						 </td>
						</tr>
				{/if}
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'checkbox' && $xsd_display_fields[i].xsdmf_enabled == 1}
            <!-- Checkbox -->
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $loop_num != 1}style="display:none"{/if} valign="top">
						  <td width="200" bgcolor="{$cell_color}" class="default">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num}</b>{if $xsd_display_fields[i].xsdmf_required == 1} * {/if}<br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appears as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$value_color}">
						<input class="default" type="checkbox" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" {if $details[$temp_fld_id][z] =='on'}checked{/if} onKeyUp="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');">
							{include file="error_icon.tpl.html" field="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"][]"}
							{if $xsd_display_fields[i].xsdmf_long_description != ""}
								<span class="default">{$xsd_display_fields[i].xsdmf_long_description}</span>
							{/if}

						 </td>
						</tr>
					{/section}
				{else}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" valign="top">
						  <td width="200" bgcolor="{$cell_color}" class="default">
							<b>{$xsd_display_fields[i].xsdmf_title}{if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
						  </td>
						  <td bgcolor="{$value_color}">
						<input class="default" type="checkbox" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" {if $details[$temp_fld_id] == 'on'}checked{/if}>
						{include file="error_icon.tpl.html" field="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}
							{if $xsd_display_fields[i].xsdmf_long_description != ""}
								<span class="default">{$xsd_display_fields[i].xsdmf_long_description}</span>
							{/if}

						 </td>
						</tr>
				{/if}
			{elseif ($xsd_display_fields[i].xsdmf_html_input == 'static' && $xsd_display_fields[i].xsdmf_show_in_view == 1 && $xsd_display_fields[i].xsdmf_static_text != '')}
                        <!-- static text -->
				{assign var="image_name" value=$fez_root_dir|cat:"images/"|cat:$xsd_display_fields[i].xsdmf_image_location} 
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"} 
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td bgcolor="{$heading_color}" class="default_white" colspan="2" nowrap>
							{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$xsd_display_fields[i].xsdmf_image_location}"> {/if}<b>{$xsd_display_fields[i].xsdmf_static_text}</b> 
							{if $xsd_display_fields[i].xsdmf_description != ""}
								&nbsp;<i>{$xsd_display_fields[i].xsdmf_description|escape:"html"}</i>
							{/if}
						  </td>
						</tr>
			{elseif ($xsd_display_fields[i].xsdmf_html_input == 'xsd_loop_subelement' && $xsd_display_fields[i].xsdmf_show_in_view == 1)}
				{assign var="image_name" value=$fez_root_dir|cat:"images/"|cat:$xsd_display_fields[i].xsdmf_image_location} 
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"} 
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td bgcolor="{$cell_color}" class="default" colspan="2" nowrap>
							{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$xsd_display_fields[i].xsdmf_image_location}"> {/if}<b>{$xsd_display_fields[i].xsdmf_title}</b>
							{if $xsd_display_fields[i].xsdmf_description != ""}
								&nbsp;<i>{$xsd_display_fields[i].xsdmf_description|escape:"html"}</i>
							{/if}
						  </td>
						</tr>

            {elseif $xsd_display_fields[i].xsdmf_html_input == 'text' && $xsd_display_fields[i].xsdmf_enabled == 1}
             <!-- text field -->
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
                                     <!-- multiple -->
					{assign var="show_num" value=0}
					{assign var="check_num" value=0}						
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						{if $show_num != 0}
							{assign var="check_num" value=$show_num-1}
						{/if}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $details[$temp_fld_id][$loop_num] == '' && $details[$temp_fld_id][$check_num] == '' && $show_num != 0}style="display:none"{/if}>
						  <td width="200" bgcolor="{$cell_color}" class="default" valign="top">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num} </b>{if $xsd_display_fields[i].xsdmf_required == 1 && $loop_num == 1} * {/if}<br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appear as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$value_color}">
					    {assign var="field_id" value="xsd_display_fields_"|cat:$xsd_display_fields[i].xsdmf_id|cat:"_"|cat:$loop_num}
						<input class="default" type="text" id="{$field_id}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" value="{$details[$temp_fld_id][z]}" onKeyUp="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" onFocus="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" size="50">
						{include file="error_icon.tpl.html" field="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"][]"}
						  {if $xsd_display_fields[i].xsdmf_attached_xsdmf_id != ""}
								{section name="a" loop=$xsd_display_fields}
									{assign var="temp_attached_xsdmf_id" value=$xsd_display_fields[a].xsdmf_id}
									{assign var="temp_attached_field_name" value="xsd_display_fields["|cat:$xsd_display_fields[a].xsdmf_id|cat:"]"}						
								  	{if $xsd_display_fields[a].xsdmf_html_input == 'author_suggestor' AND $temp_attached_xsdmf_id == $xsd_display_fields[i].xsdmf_attached_xsdmf_id}
										<br />
										<span class="default"><b>{$xsd_display_fields[a].xsdmf_title}:</b></span>
									    {assign var="attached_field_id" value="xsd_display_fields_"|cat:$temp_attached_xsdmf_id|cat:"_"|cat:$loop_num}
										<select class="default" id="{$attached_field_id}" name="{$attached_field_id}">
										   <option value="0">(none)</option>
  										   {if $details[$temp_attached_xsdmf_id][z] != 0}
										   <option value="{$details[$temp_attached_xsdmf_id][z]}" selected> {$details[$temp_fld_id][z]} ({$details[$temp_attached_xsdmf_id][z]})</option>
										   {/if}
										</select>
						                <!-- Google suggest style selection -->
										<input type="text" name="{$attached_field_id}_lookup" id="{$attached_field_id}_lookup" size="30"
										autocomplete="off" class="default" />
										<!-- note there is some javascript in the window.load because IE can't handle it here -->
									  </td>
									</tr>
								  	{elseif $xsd_display_fields[a].xsdmf_html_input == 'author_selector' AND $temp_attached_xsdmf_id == $xsd_display_fields[i].xsdmf_attached_xsdmf_id}
										<br />
										<span class="default"><b>{$xsd_display_fields[a].xsdmf_title}:</b></span>
									    {assign var="attached_field_id" value="xsd_display_fields_"|cat:$temp_attached_xsdmf_id|cat:"_"|cat:$loop_num}
										<select class="default" id="{$attached_field_id}" name="{$attached_field_id}">
										   <option value="0">(none)</option>
										  {html_options options=$author_ids selected=$details[$temp_attached_xsdmf_id][z]}										   
										</select>
										{include file="lookup_field.tpl.html" lookup_field_name="search" lookup_field_target=$attached_field_id}
									  </td>
									</tr>

									{/if}
								{/section}
						  {/if}
						 </td>
						</tr>
						{assign var="show_num" value=$show_num+1}
					{/section}
				    {else}
                                    <!-- single -->
                                      <tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
                                        <td width="200" bgcolor="{$cell_color}" class="default">
                                          <b>{$xsd_display_fields[i].xsdmf_title} 
                                            {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
                                          {if $xsd_display_fields[i].xsdmf_description != ""}
                                          <br/><i>{$xsd_display_fields[i].xsdmf_description|escape:"html"}</i>
                                          {/if}
                                        </td>
                                        <td bgcolor="{$value_color}">
                                          {assign var="field_id" 
                                              value="xsd_display_fields_"|cat:$xsd_display_fields[i].xsdmf_id|cat:"_1"}
                                          <span class="default">{$xsd_display_fields[i].xsdmf_value_prefix}</span>
                                          <input class="default" type="text" id="{$field_id}" 
                                          name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" 
                                          value="{$details[$temp_fld_id]}"  size="50"/>
                                          {include file="error_icon.tpl.html" 
                                              field="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}
                                          {if $xsd_display_fields[i].xsdmf_long_description != ""}
                                          <div class="default">{$xsd_display_fields[i].xsdmf_long_description}</div>
                                          {/if}
                                        </td>
                                      </tr>
				{/if}
			{elseif $xsd_display_fields[i].xsdmf_html_input == 'author_selector'}
                        <!-- author selector -->
				{assign var="field_name" value="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}						
			    {assign var="field_id" value="xsd_display_fields_"|cat:$xsd_display_fields[i].xsdmf_id|cat:"_1"}
				<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
				  <td width="200" bgcolor="{$cell_color}" class="default">
					<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
				  </td>
				  <td bgcolor="{$light_color}">
					<select class="default" id="{$field_id}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]">
					   <option value="0">(none)</option>
					  {html_options options=$xsd_display_fields[i].field_options selected=$details[$temp_fld_id]}
					</select>
					{include file="lookup_field.tpl.html" lookup_field_name="search" lookup_field_target=$field_name}
				  </td>
				</tr>
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'textarea' && $xsd_display_fields[i].xsdmf_enabled == 1}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="200" bgcolor="{$cell_color}" class="default" valign="top">
							<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
						  </td>
						  <td bgcolor="{$value_color}">
				            <textarea class="default" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" rows="10" cols="60">{$details[$temp_fld_id]}</textarea>
							{include file="error_icon.tpl.html" field="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}
						  </td>
						 </tr>
            {elseif ($xsd_display_fields[i].xsdmf_html_input == 'org_selector') && $xsd_display_fields[i].xsdmf_enabled == 1}
				{assign var="field_name" value="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}							
				{if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}
					{assign var="field_name" value=$field_name|cat:"[]"}
				{/if}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="200" bgcolor="{$cell_color}" class="default">
							<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
						  </td>
						  
						  <td bgcolor="{$light_color}">
							<div id="loading_{$xsd_display_fields[i].xsdmf_id}" style="display:none;" class="default">Loading...</div>
							<select id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" {if $xsd_display_fields[i].xsdmf_use_org_to_fill == 1}onChange="javascript: selectOrgStructure_{$xsd_display_fields[i].xsdmf_id}(this.form, 'xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]')"{/if} {if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}multiple size="8"{/if} class="default" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]{if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}[]{/if}">
							  {if $xsd_display_fields[i].xsdmf_html_input != 'multiple'}<option value="-1">Please choose an option</option>{/if}
								  {html_options options=$xsd_display_fields[i].field_options selected=$details[$temp_fld_id]}
							</select>
							{include file="error_icon.tpl.html" field=$field_name}
						 </td>
						</tr>
            {elseif ($xsd_display_fields[i].xsdmf_html_input == 'multiple' or $xsd_display_fields[i].xsdmf_html_input == 'combo')  && $xsd_display_fields[i].xsdmf_enabled == 1}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="200" bgcolor="{$cell_color}" class="default" valign="top">
							<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
						  </td>
						  <td bgcolor="{$value_color}">
	  					    {assign var="field_name" value="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"]"}							
							{if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}
								{assign var="field_name" value=$field_name|cat:"[]"}
							{/if}
							<select {if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}multiple size="8"{/if} class="default" name="{$field_name}">
							  {if $xsd_display_fields[i].xsdmf_html_input != 'multiple'}<option value="-1">Please choose an option</option>{/if}
							  {html_options options=$xsd_display_fields[i].field_options selected=$details[$temp_fld_id]}
							</select>
							{include file="error_icon.tpl.html" field=$field_name}
						  </td>
						 </tr>
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'date' && $xsd_display_fields[i].xsdmf_enabled == 1}
              <tr>
				  <td width="200" bgcolor="{$cell_color}" class="default">
					<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
				  </td>
                <td nowrap bgcolor="{$value_color}">
                  {assign var="temp_xsdmf_id" value=$xsd_display_fields[i].xsdmf_id}
					{* Convert reminder date to format usable by html_select_date *}
					{if $details[$temp_fld_id] == ''}
						{assign var="full_date" value='0000-00-00'}
					{else}
						{assign var="full_date" value=$details[$temp_fld_id]}
						{assign var="attached_temp_fld_id" value=$xsd_display_fields[i].xsdmf_attached_xsdmf_id}
						{* Set the start year to be whatever the current reminder date is *}
						{if $full_date|substr:"7":"2" != '' && $details[$attached_temp_fld_id] == 0}
							{assign var="full_day" value=$full_date|substr:"8":"2"}
						{else}
							{assign var="full_day" value="00"}
						{/if}
						{if $full_date|substr:"5":"2" != '' && $details[$attached_temp_fld_id] != 1}
							{assign var="full_month" value=$full_date|substr:"5":"2"}
						{else}
							{assign var="full_month" value="00"}
						{/if}
						{if $full_date|substr:"0":"4" != ''}
							{assign var="full_year" value=$full_date|substr:"0":"4"}				
						{else}
							{assign var="full_year" value="0000"}
						{/if}
						{assign var="full_date" value=$full_year|cat:"-"|cat:$full_month|cat:"-"|cat:$full_day}
					{/if}


                  {html_select_date time=$full_date month_empty='' year_empty='' day_empty='' field_array="xsd_display_fields[$temp_xsdmf_id]" prefix="" start_year="-50" end_year="+0" all_extra='class="default" onChange="javascript:checkDateFilterType(this.form, this);"'}
                                  {literal}
                  <script language="JavaScript" type="text/javascript">
                  <!--
                  tCalendar_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal} = new dynCalendar('tCalendar_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}', 'calendarCallback_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}', '{/literal}{$rel_url}{literal}images/');
                  tCalendar_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}.setMonthCombo(false);
                  tCalendar_xsd_display_fields{/literal}{$xsd_display_fields[i].xsdmf_id}{literal}.setYearCombo(false);
                  //-->
                  </script>{/literal}&nbsp;&nbsp;				
                </td>
              </tr>
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'contvocab_selector' && $xsd_display_fields[i].xsdmf_enabled == 1}

					<tr id="tr_list_{$list[i].xsdmf_id}_1" valign="top">
					  <td width="200" bgcolor="{$cell_color}" class="default">
						<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
					  </td>
					  <td bgcolor="{$value_color}">
					   {assign var="field_name" value="xsd_display_fields["|cat:$xsd_display_fields[i].xsdmf_id|cat:"][]"}
						<select id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" multiple size="10" class="default" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]">
							{if $details[$temp_fld_id]}
							  {html_options options=$details[$temp_fld_id]}
							 {/if}
						</select>
						{include file="error_icon.tpl.html" field=$field_name}
						<input class="default" type=button value="Add Subject" onclick = "javascript:small_window('{$rel_url}cv_selector.php?cvo_id={$xsd_display_fields[i].xsdmf_cvo_id}&form=wfl_form1&element=xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1&xsdmf_cvo_min_level={$xsd_display_fields[i].xsdmf_cvo_min_level}');">
						<input class="default" type=button value="Remove Subject" onclick =" javascript:deleteSelectedItemsFromList(xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1);">
					 </td>
					</tr>						  			  
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'contvocab'  && $xsd_display_fields[i].xsdmf_enabled == 1}

					<tr id="tr_list_{$list[i].xsdmf_id}_1" valign="top">
					  <td width="200" bgcolor="{$cell_color}" class="default">
						<b>{$xsd_display_fields[i].xsdmf_title} {if $xsd_display_fields[i].xsdmf_required == 1} * {/if}</b>
					  </td>
					  <td bgcolor="{$value_color}">
						<select id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" multiple size="15" class="default" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]">
							  {html_options options=$xsd_display_fields[i].field_options selected=$details[$temp_fld_id]}
						</select>
					 </td>
					</tr>				

            {/if}
            {assign var="custom_field_id" value=$xsd_display_fields[i].xsdmf_id}

            {if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}
              {assign var="custom_field_sufix" value="[]"}
            {else}
              {assign var="custom_field_sufix" value=""}
            {/if}
			</table>
		</td></tr>
				{/if}
			{/if}
		{/if}
        {/section}

		
		  <tr>
			<td class="default" colspan="3">&nbsp;</td>
		  </tr>
        <tr>
		  <td colspan="2" class="default">
			<table border="0" cellpadding="2" cellspacing="0" width="100%"  bgcolor="#FFFFFF" >
			  <tr>
				<td class="default_white" colspan="4" bgcolor="{$heading_color}" height="22"><b>Attached Files</b></td>
			  </tr>

			  <tr class="default">
				<td bgcolor="{$cell_color}">Name</td>
				<td bgcolor="{$cell_color}">Description</td>
				<td bgcolor="{$cell_color}">MIMEType</td>
			  </tr>

        {section name="d" loop=$datastreams}
			{if $datastreams[d].controlGroup == "M" && ($datastreams[d].isLister == 1 || $isAdministrator)}
			  <tr class="default"> 
				{assign var="image_file_name" value=$datastreams[d].MIMEType|replace:"/":"_"|cat:".png"}
				{assign var="image_name" value=$fez_root_dir|cat:"images/"|cat:$image_file_name} 			
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"}
				<td bgcolor="{$value_color}">{if $datastreams[d].thumbnail != "0"}<img align="absmiddle" src="{$eserv_url}{$datastreams[d].thumbnail}">{/if}{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$image_file_name}">{else}<img align="absmiddle" src="{$rel_url}images/default.png">{/if} {if $datastreams[d].isViewer == 1 || $isAdministrator}<a target="_blank" href="{$rel_url}eserv.php?pid={$pid}&dsID={$datastreams[d].ID}">{/if}{$datastreams[d].ID}{if $datastreams[d].isViewer == 1 || $isAdministrator}</a>&nbsp;{/if} {if ($datastreams[d].isArchivalViewer == 1 || $isAdministrator) && $datastreams[d].thumbnail != "0"}<a target="_blank" href="{$rel_url}eserv.php?pid={$pid}&dsID=archival_{$datastreams[d].ID}"><img title="archival version" align="absmiddle" border="0" src="{$rel_url}images/archival_22.gif"></a>&nbsp;{/if} {if $datastreams[d].presmd != "0" && $datastreams[d].isViewer == 1 || $isAdministrator}<a target="_blank" href="{$rel_url}eserv.php?pid={$pid}&dsID={$datastreams[d].presmd}"><img title="preservation metadata" align="absmiddle" border="0" src="{$rel_url}images/presmd_22.gif"></a>&nbsp;{/if} {if $datastreams[d].isEditor == 1 || $isAdministrator}[ <a class="link" title="purge datastream" href="javascript:void(null);" onClick="javascript:purgeDatastream('{$datastreams[d].ID}');">purge</a> ]{/if}				
				{section name="w" loop=$datastreams[d].workflows}
					{if $datastreams[d].workflows[w].wft_icon == 'images/security.gif'}
						{if $datastreams[d].security == 'include'}
							{assign var="wf_icon" value="images/security_include.gif"}
						{elseif $datastreams[d].security == 'exclude'}
							{assign var="wf_icon" value="images/security_exclude.gif"}
						{elseif $datastreams[d].security == 'inherit'}
							{assign var="wf_icon" value="images/security_inherit.gif"}
						{else}
							{assign var="wf_icon" value="images/security_inherit.gif"}
						{/if}
					{else}
						{assign var="wf_icon" value="images/security_inherit.gif"}
					{/if}
					{if $datastreams[d].isEditor == 1 || $isAdministrator}&nbsp;<a href='{$rel_url}workflow/update.php?pid={$pid|escape:"html"}&dsID={$datastreams[d].ID}&cat=select_workflow&wft_id={$datastreams[d].workflows[w].wft_id}&href={$smarty.server.REQUEST_URI}'><img title="{$datastreams[d].workflows[w].wfl_title}" align="absmiddle" src="{$rel_url}{$wf_icon}" border="0"></a>{/if}
				{/section}
				</td>

				<td bgcolor="{$value_color}">{$datastreams[d].label}</td>
				<td bgcolor="{$value_color}">{$datastreams[d].MIMEType}</td>
			  </tr>
			 {/if}
        {/section}
		
		  <tr>
			<td class="default" colspan="4">&nbsp;</td>
		  </tr>
		  <tr>
			<td class="default_white" colspan="4" bgcolor="{$heading_color}" height="22"><b>Related Links</b></td>
		  </tr>

		  <tr class="default">
			<td colspan="1" bgcolor="{$cell_color}">Link</td>
			<td colspan="3" bgcolor="{$cell_color}">Description</td>			
		  </tr>

        {section name="d" loop=$datastreams}
			{if $datastreams[d].controlGroup == "R" && $datastreams[d].ID != 'DOI'}
			  <tr class="default"> 
				<td colspan="1" bgcolor="{$light_color}"><img align="absmiddle" src="{$rel_url}images/text_html.png"> <a target="_blank" href="{$datastreams[d].location}">{$datastreams[d].location}</a> &nbsp; </td>
				<td colspan="3" bgcolor="{$light_color}">{$datastreams[d].label} &nbsp; [ <a class="link" title="purge datastream" href="javascript:void(null);" onClick="javascript:purgeDatastream('{$datastreams[d].ID}');">purge</a> ]</td>
			  </tr>
			 {/if}
        {/section}		
		  <tr>
			<td class="default" colspan="3">&nbsp;</td>
		  </tr>
		    </table>
		  </td>
		</tr>			
</table>

</td>
</tr>
</table>
{section name="i" loop=$xsd_display_fields}
	{if $xsd_display_fields[i].xsdmf_html_input == 'org_selector' && $xsd_display_fields[i].xsdmf_use_org_to_fill == 1}
		<script language="JavaScript">
		  <!--
//		  selectOrgStructure_{$xsd_display_fields[i].xsdmf_id}(document.wfl_form1, 'xsdmf_display_fields_{$xsd_display_fields[i].xsdmf_id}_1'); 	
		  //-->
		  </script>
	{/if}
{/section}
