<tr><td>
<div class="outline">
{if $conflict}
<div class="admin-header">Editing Conflict</div>
<div class="default admin-content">The record you have selected is currently being edited by {$conflict_user}.  <a href="{$link_self}">Check again</a></div>
{else}

<link rel="stylesheet" href="{$rel_url}css/autocomplete.css" type="text/css" />
<script type="text/javascript" src="{$rel_url}js/yahoo/utilities.js"></script>
<script type="text/javascript" src="{$rel_url}js/yahoo/autocomplete.js"></script>
<script type="text/javascript" src="{$rel_url}min.php/editmeta.js"></script>
<script type="text/javascript" src="{$rel_url}js/textarea.js"></script>
{include file='workflow/edit_metadata_helpers/javascript_block.tpl.html'}

<input type="hidden" name="cat" value="update_form">
<input type="hidden" name="xdis_id" value="{$xdis_id}">
<input type="hidden" name="sta_id" value="{$sta_id}">
<input type="hidden" name="pid" value="{$pid}">
<input type="hidden" name="id" value="{$id}">
<input type="hidden" name="user_id" value="{$current_user_id}">
<input type="hidden" name="userfullname" value="{$current_full_name}">
{foreach from=$xsdmf_states item=xsdmf_state}
<input type="hidden" name="state" value="{$xsdmf_state.xsdmf_static_text}">
{/foreach}

      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="0" border="0" id="edit_metadata_form_table">
        <tr>
          <td class="default_white" bgcolor="{$heading_color}" colspan="10">
            &nbsp;<img align="absmiddle" src="{$rel_url}images/edit_32.gif"><b>Edit {$xdis_title} Record</b>
          </td>
        </tr>
        {section name="i" loop=$xsd_display_fields}
			{assign var="temp_fld_id" value=$xsd_display_fields[i].xsdmf_id}
			{assign var='xsdmf' value=$xsd_display_fields[i]}
			{include file='workflow/edit_metadata_helpers/field_'|cat:$xsd_display_fields[i].xsdmf_html_input|cat:'.tpl.html'}
			{if $debug == 1}
				{$xsd_display_fields[i].xsdmf_order}
			{/if}
        {/section}
      </table>

{if $fileCount > 0}
<table border="0" cellpadding="2" cellspacing="0" width="100%"  bgcolor="#FFFFFF" >
			  <tr>
				<td class="default_white" colspan="4" bgcolor="{$heading_color}" height="22"><b>Attached Files</b></td>
			  </tr>

			  <tr class="default">
				<td bgcolor="{$cell_color}">Name</td>
				<td bgcolor="{$cell_color}">Description</td>
				<td bgcolor="{$cell_color}">MIMEType</td>
			  </tr>

        {section name="d" loop=$datastreams}
			{if $datastreams[d].controlGroup == "M" && ($datastreams[d].isLister == 1 || $isAdministrator)}
			  <tr class="default"> 
				{assign var="image_file_name" value=$datastreams[d].MIMEType|replace:"/":"_"|cat:".png"}
				{assign var="image_name" value=$fez_root_dir|cat:"images/"|cat:$image_file_name} 			
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"}
				<td bgcolor="{$value_color}">
				{if $datastreams[d].thumbnail != "0"}<img align="absmiddle" src="{$eserv_url}{$datastreams[d].thumbnail}">{/if}
				{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$image_file_name}">{else}<img align="absmiddle" src="{$rel_url}images/default.png">{/if} {if $datastreams[d].isViewer == 1 || $isAdministrator}<a target="_blank" href="{$rel_url}eserv/{$pid}/{$datastreams[d].web}">{/if}{$datastreams[d].ID}{if $datastreams[d].isViewer == 1 || $isAdministrator}</a>&nbsp;{/if} {if ($datastreams[d].isArchivalViewer == 1 || $isAdministrator) && $datastreams[d].thumbnail != "0"}<a target="_blank" href="{$rel_url}eserv/{$pid}/{$datastreams[d].ID}"><img title="archival version" align="absmiddle" border="0" src="{$rel_url}images/archival_22.gif"></a>&nbsp;{/if} {if $datastreams[d].presmd != "0" && $datastreams[d].isViewer == 1 || $isAdministrator}<a target="_blank" href="{$rel_url}eserv/{$pid}/{$datastreams[d].presmd}"><img title="preservation metadata" align="absmiddle" border="0" src="{$rel_url}images/presmd_22.gif"></a>&nbsp;{/if} {if ($showDelete && ($datastreams[d].isEditor == 1 || $isAdministrator))}[ <a class="link" title="delete datastream" href="javascript:void(null);" onClick="javascript:deleteDatastream('{$pid}','{$datastreams[d].ID}');">delete</a> ]{/if}  {if (($showPurge && $datastreams[d].isEditor == 1) || $isAdministrator)}[ <a class="link" title="purge datastream" href="javascript:void(null);" onClick="javascript:purgeDatastream('{$pid}','{$datastreams[d].ID}');">purge</a> ]{/if}				
				{section name="w" loop=$datastreams[d].workflows}
					{if $datastreams[d].workflows[w].wft_icon == 'images/security.gif'}
						{if $datastreams[d].FezACML.security == 'include'}
							{assign var="wf_icon" value="images/security_include.gif"}
						{elseif $datastreams[d].FezACML.security == 'exclude'}
							{assign var="wf_icon" value="images/security_exclude.gif"}
						{elseif $datastreams[d].FezACML.security == 'inherit'}
							{assign var="wf_icon" value="images/security_inherit.gif"}
						{else}
							{assign var="wf_icon" value="images/security_inherit.gif"}
						{/if}
					{else}
						{assign var="wf_icon" value="images/security_inherit.gif"}
					{/if}
					{if $datastreams[d].isEditor == 1 || $isAdministrator}&nbsp;<a href='{$rel_url}workflow/update.php?pid={$pid|escape:"html"}&dsID={$datastreams[d].ID}&cat=select_workflow&wft_id={$datastreams[d].workflows[w].wft_id}&href={$smarty.server.REQUEST_URI}'><img title="{$datastreams[d].workflows[w].wfl_title}" align="absmiddle" src="{$rel_url}{$wf_icon}" border="0"></a>{/if}
				{/section}
				</td>

				<td bgcolor="{$value_color}">{$datastreams[d].label}</td>
				<td bgcolor="{$value_color}">{$datastreams[d].MIMEType}</td>
			  </tr>
			 {/if}
        {/section}
</table>
{/if}

{* Internal Notes *}
{if $isAdministrator && $APP_INTERNAL_NOTES == 'ON'}
	<table border="0" cellpadding="2" cellspacing="0" width="100%"  bgcolor="#FFFFFF" >
		<tr>
			<td class="default_white" bgcolor="{$heading_color}" height="22"><b>Internal Notes</b> &nbsp; (Administrators only - will not be publically displayed)</td>
		</tr>
		<tr class="default">
			<td bgcolor="{$cell_color}">
				<textarea style="width: 95%; height: 100px;" name="internal_notes">{$internal_notes}</textarea>
			</td>
		</tr>
	</table>
{/if}
	
{* Reason for Edit *}
<table border="0" cellpadding="2" cellspacing="0" width="100%"  bgcolor="#FFFFFF" >
	<tr>
		<td class="default_white" bgcolor="{$heading_color}" height="22"><b>Reason for Edit</b> &nbsp; (optional - will be added to object history)</td>
	</tr>
	<tr class="default">
		<td bgcolor="{$cell_color}">
			<input type="text" name="edit_reason" style="width: 95%;" />
		</td>
	</tr>
</table>

{/if}				  
</div>
</td></tr>

<script>init_textarea_validation();</script>
