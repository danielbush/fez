{literal}
<script language="JavaScript">
<!--
function purgeDatastream(ds_id)
{
    if (!confirm('This action will permanently delete the selected datastream.')) {
        return false;
    } else {
        var features = 'width=420,height=200,top=30,left=30,resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
        var popupWin = window.open('popup.php?cat=purge_datastream&pid={/literal}{$pid}{literal}&ds_id=' + ds_id, '_popup', features);
        popupWin.focus();
    }
}
function updateForm()
{
  var features = 'width=420,height=200,top=30,left=30,resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
  var updateWin = window.open('', '_update_record_details', features);
  updateWin.focus();
  return true;
}
//-->
</script>
{/literal}


{if $new_record_id != "" and $smarty.post.report_stays != "yes"}
<table width="500" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td class="default">
            <b>Thank you, the new record was created successfully. Please choose 
            from one of the options below:</b>
            <ul>
              <li><a href="view.php?id={$new_record_id}" class="link">Open the Record Details Page</a></li>
              <li><a href="list.php" class="link">Open the Record Listing Page</a></li>
              {if $app_setup.support_email == 'enabled' and $current_role > $roles.viewer}
              <li><a href="emails.php" class="link">Open the Emails Listing Page</a></li>
              {/if}
              <li><a href="new.php" class="link">Report a New Record</a></li>
            </ul>
            <b>Otherwise, you will be automatically redirected to the Record Details Page in 5 seconds.</b>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
{literal}
<script language="JavaScript">
<!--
setTimeout('openDetailPage()', 5000);
function openDetailPage()
{
{/literal}
    window.location.href = 'view.php?pid={$new_record_id}';
{literal}
}
//-->
</script>

{/literal}
{/if}
<table width="99%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">


<form name="report_form" onSubmit="javascript:return updateForm();" target="_update_record_details" action="popup.php" method="POST" enctype="multipart/form-data">
<input type="hidden" name="cat" value="update_form">
<input type="hidden" name="xdis_id" value="{$xdis_id}">
<input type="hidden" name="pid" value="{$pid}">
{section name="i" loop=$xsd_display_fields}
	{if $xsd_display_fields[i].xsdmf_title == 'state'}
<input type="hidden" name="state" value="{$xsd_display_fields[i].xsdmf_static_text}">
	{/if}
{/section}
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="0" border="0">
        <tr>
          <td class="default">
            <b>Edit Record</b>
          </td>
          <td align="right" class="default">&nbsp;
            
          </td>
        </tr>
		<tr>
		  <td colspan="2" align="left"> <br />
			<table bgcolor="#FFFFFF" border="0" cellspacing="0" cellpadding="1">
				<tr>
				  <td align="left" class="default" nowrap> <b>Parent Collections: </b></td>
				  <td align="left" class="default" nowrap> &nbsp;
					{section name="i" loop=$parents}
						<a href="list.php?collection_pid={$parents[i].pid}">{$parents[i].title}</a> &nbsp;
					{/section}
				  </td>
				</tr>
			</table>
		  </td>
		</tr>
        {section name="i" loop=$xsd_display_fields}
		{assign var="temp_fld_id" value=$xsd_display_fields[i].xsdmf_id}
		{if ($xsd_display_fields[i].xsdmf_html_input != 'xsdmf_id_ref' and $xsd_display_fields[i].xsdmf_html_input != 'xsd_ref' and $xsd_display_fields[i].xsdmf_html_input != '')}
		  {if ((($xsd_display_fields[i].xsdmf_html_input == 'static') && ($xsd_display_fields[i].xsdmf_show_in_view == 1)) || ($xsd_display_fields[i].xsdmf_html_input != 'static'))}
			  {if ((($xsd_display_fields[i].xsdmf_html_input == 'xsd_loop_subelement') && ($xsd_display_fields[i].xsdmf_show_in_view == 1)) || ($xsd_display_fields[i].xsdmf_html_input != 'xsd_loop_subelement'))}
        <tr><td colspan="2" class="default">
	<table id="choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}" border="0" cellpadding="2" cellspacing="0" width="100%">

            {if $xsd_display_fields[i].xsdmf_html_input == 'file_input'}
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $loop_num != 1}style="display:none"{/if}>
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num}</b><br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appears as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="file" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" maxlength="255" size="50">
						 </td>
						</tr>
					{/section}
				{else}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title}</b>
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="file" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]"  maxlength="255" size="50">
						 </td>
						</tr>
				{/if}
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'checkbox'}
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $loop_num != 1}style="display:none"{/if}>
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num}</b><br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appears as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="checkbox" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" {if $details[$temp_fld_id][z] =='on'}checked{/if} onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');">
						 </td>
						</tr>
					{/section}
				{else}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title}</b>
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="checkbox" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" {if $details[$temp_fld_id] == 'on'}checked{/if}>
						 </td>
						</tr>
				{/if}
			{elseif ($xsd_display_fields[i].xsdmf_html_input == 'static' && $xsd_display_fields[i].xsdmf_show_in_view == 1 && $xsd_display_fields[i].xsdmf_static_text != '')}
				{assign var="image_name" value=$espace_root_dir|cat:"images/"|cat:$xsd_display_fields[i].xsdmf_image_location} 
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"} 
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white" colspan="2" nowrap>
							{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$xsd_display_fields[i].xsdmf_image_location}"> {/if}<b>{$xsd_display_fields[i].xsdmf_static_text}</b> 
							{if $xsd_display_fields[i].xsdmf_description != ""}
								&nbsp;<i>{$xsd_display_fields[i].xsdmf_description|escape:"html"}</i>
							{/if}
						  </td>
						</tr>
			{elseif ($xsd_display_fields[i].xsdmf_html_input == 'xsd_loop_subelement' && $xsd_display_fields[i].xsdmf_show_in_view == 1)}
				{assign var="image_name" value=$espace_root_dir|cat:"images/"|cat:$xsd_display_fields[i].xsdmf_image_location} 
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"} 
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td bgcolor="{$cell_color}" class="default_white" colspan="2" nowrap>
							{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$xsd_display_fields[i].xsdmf_image_location}"> {/if}<b>{$xsd_display_fields[i].xsdmf_title}</b>
							{if $xsd_display_fields[i].xsdmf_description != ""}
								&nbsp;<i>{$xsd_display_fields[i].xsdmf_description|escape:"html"}</i>
							{/if}
						  </td>
						</tr>

            {elseif $xsd_display_fields[i].xsdmf_html_input == 'text'}
				{if $xsd_display_fields[i].xsdmf_multiple == 1}
					{assign var="show_num" value=0}
					{assign var="check_num" value=0}						
					{section name="z" loop=$xsd_display_fields[i].multiple_array}
						{assign var="loop_num" value=$xsd_display_fields[i].multiple_array[z]}
						{if $show_num != 0}
							{assign var="check_num" value=$show_num-1}
						{/if}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" {if $details[$temp_fld_id][$loop_num] == '' && $details[$temp_fld_id][$check_num] == '' && $show_num != 0}style="display:none"{/if}>
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title} {$loop_num} </b><br />{if $loop_num == 1}<i>(More {$xsd_display_fields[i].xsdmf_title} input boxes will appear as they are used up)</i>{/if}
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="text" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_{$loop_num}" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}][]" value="{$details[$temp_fld_id][z]}" onChange="javascript:unhideRow('xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}', 'choicexsd_display_fields_{$xsd_display_fields[i].xsdmf_id}');" maxlength="255" size="50">
						 </td>
						</tr>
						{assign var="show_num" value=$show_num+1}
					{/section}
				{else}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title}</b>
						  </td>
						  <td bgcolor="{$light_color}">
						<input class="default" type="text" id="xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" value="{$details[$temp_fld_id]}"  maxlength="255" size="50">
				{/if}
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'textarea'}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title}</b>
						  </td>
						  <td bgcolor="{$light_color}">
				            <textarea name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]" rows="10" cols="60">{$details[$temp_fld_id]}</textarea>
            {elseif $xsd_display_fields[i].xsdmf_html_input == 'multiple' or $xsd_display_fields[i].xsdmf_html_input == 'combo'}
						<tr id="tr_xsd_display_fields_{$xsd_display_fields[i].xsdmf_id}_1">
						  <td width="150" bgcolor="{$cell_color}" class="default_white">
							<b>{$xsd_display_fields[i].xsdmf_title}</b>
						  </td>
						  <td bgcolor="{$light_color}">
							<select {if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}multiple size="8"{/if} class="default" name="xsd_display_fields[{$xsd_display_fields[i].xsdmf_id}]{if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}[]{/if}">
							  {if $xsd_display_fields[i].xsdmf_html_input != 'multiple'}<option value="-1">Please choose an option</option>{/if}
							  {html_options options=$xsd_display_fields[i].field_options selected=$details[$temp_fld_id]}
							</select>
            {/if}
            {assign var="custom_field_id" value=$xsd_display_fields[i].xsdmf_id}

            {if $xsd_display_fields[i].xsdmf_html_input == 'multiple'}
              {assign var="custom_field_sufix" value="[]"}
            {else}
              {assign var="custom_field_sufix" value=""}
            {/if}
			{if $xsd_display_fields[i].xsdmf_multiple != 1}
				{include file="error_icon.tpl.html" field="xsd_display_fields[$custom_field_id]$custom_field_sufix"}
				{if $xsd_display_fields[i].xsdmf_description != "" && $xsd_display_fields[i].xsdmf_html_input != 'xsd_loop_subelement' && $xsd_display_fields[i].xsdmf_html_input != 'static'}
				<span class="small_default">({$xsd_display_fields[i].xsdmf_description|escape:"html"})</span>
				{/if}
	
							 </td>
							</tr>
			{/if}
	</table>
		</td></tr>
				{/if}
			{/if}
		{/if}
        {/section}

        <tr>
		  <td colspan="2" class="default">
			<table border="0" cellpadding="2" cellspacing="0" width="100%"  bgcolor="#FFFFFF" >
			  <tr>
				<td class="default" colspan="3"><b>Attached Datastreams</b></td>
			  </tr>

			  <tr class="default_white">
				<td bgcolor="{$cell_color}">Name</td>
				<td bgcolor="{$cell_color}">MIMEType</td>
				<td bgcolor="{$cell_color}">Size</td>
			  </tr>

        {section name="d" loop=$datastreams}
			  <tr class="default"> 

				{assign var="image_file_name" value=$datastreams[d].MIMEType|replace:"/":"_"|cat:".png"}
				{assign var="image_name" value=$espace_root_dir|cat:"images/"|cat:$image_file_name} 
				
				{assign var="image_file_string" value=""}

				{fetch file=$image_name assign="image_file_string"}
				<td bgcolor="{$light_color}">{if $datastreams[d].thumbnail != "0"}<img align="absmiddle" src="{$eserv_url}{$datastreams[d].thumbnail}">{/if}{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$image_file_name}">{else}<img align="absmiddle" src="{$rel_url}images/default.png">{/if} <a target="_blank" href="eserv.php?pid={$pid}&dsID={$datastreams[d].ID}">{$datastreams[d].ID}</a> &nbsp;{if $datastreams[d].presmd != "0"}<a target="_blank" href="eserv.php?pid={$pid}&dsID={$datastreams[d].presmd}"><img title="preservation metadata" align="absmiddle" border="0" src="images/presmd_22.gif"></a>{/if}&nbsp; [ <a class="link" title="purge datastream" href="javascript:void(null);" onClick="javascript:purgeDatastream('{$datastreams[d].ID}');">purge</a> ]</td>
				<td bgcolor="{$light_color}">{$datastreams[d].MIMEType}</td>
				<td bgcolor="{$light_color}">{$datastreams[d].size} bytes</td>
			  </tr>
        {/section}
		    </table>
		  </td>
		</tr>			

        <tr>
          <td colspan="2" bgcolor="{$cell_color}">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td width="10" nowrap class="default_white">
                  <nobr>
                  <input type="checkbox" name="report_stays" value="yes" tabindex="11"> <b><a id="white_link" class="white_link" href="javascript:void(null);" onClick="javascript:toggleCheckbox('report_form', 'report_stays');">Keep Form Open</a></b>
                  </nobr>
                </td>
                <td width="100%" align="center">
                  <input class="button" type="submit" value="Submit" tabindex="12">&nbsp;&nbsp;
                  <input class="button" type="reset" value="Reset" tabindex="13">
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td colspan="2" class="default">
            <b>* Required fields</b>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</form>
</table>
