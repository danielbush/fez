
{literal}
<script language="JavaScript">
<!--
function validatePhoneSupportForm(f)
{
    if ((isWhitespace(f.call_length.value)) || (!isNumberOnly(f.call_length.value))) {
        alert('Please enter integers (or floating point numbers) on the time spent field.');
        selectField(f, 'call_length');
        return false;
    }
    if (isWhitespace(f.description.value)) {
        alert('Please enter the description for this new phone support entry.');
        selectField(f, 'description');
        return false;
    }
    var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('', '_phone_support', features);
    popupWin.focus();
    return true;
}
function deletePhoneEntry(phone_id)
{
    if (!confirm('This action will permanently delete the specified phone support entry.')) {
        return false;
    } else {
        var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
        var popupWin = window.open('popup.php?cat=delete_phone&id=' + phone_id, '_popup', features);
        popupWin.focus();
    }
}
//-->
</script>
{/literal}
<br />
<table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
<form name="add_phone_form" target="_phone_support" onSubmit="javascript:return validatePhoneSupportForm(this);" method="post" action="{$rel_url}popup.php">
<input type="hidden" name="cat" value="add_phone">
<input type="hidden" name="issue_id" value="{$smarty.get.id}">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2">
        <tr>
          <td class="default">
          <b>Phone Calls ({$phone_entries|@count})</b>
        </td>
        <td align="right" class="default">
            {if $browser.ie5up or $browser.ns6up or $browser.gecko}
            [ <a id="phone_support_link" class="link" href="javascript:void(null);" onClick="javascript:toggleVisibility('phone_support');">{get_innerhtml element_name="phone_support"}</a> ]
            {/if}
        </td>
        </tr>
        <tr id="phone_support1" {get_display_style element_name="phone_support"}>
          <td colspan="2">
            <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2">
              <tr bgcolor="{$internal_color}">
                <td class="default_white" NOWRAP>{include file="expandable_cell/buttons.tpl.html" remote_func="getPhoneSupport" ec_id="phone"}</td>
                <td width="20%" class="default_white">Recorded Date</td>
                <td width="20%" class="default_white">User</td>
                <td width="20%" class="default_white">Call Type</td>
                <td width="20%" class="default_white">Reason</td>
                <td width="20%" class="default_white">Phone Number</td>
              </tr>
              {section name="i" loop=$phone_entries}
              {cycle values=$cycle assign="row_color"}
              <tr bgcolor="{$row_color}">
                <td class="default" NOWRAP>{include file="expandable_cell/buttons.tpl.html" ec_id="phone" list_id=$phone_entries[i].phs_id}</td>
                <td class="default">{$phone_entries[i].phs_created_date}</td>
                <td class="default">
                    {$phone_entries[i].usr_full_name}
                  {if $current_user_id == $phone_entries[i].phs_usr_id}
                      [ <a class="link" href="javascript:void(null);" onClick="javascript:deletePhoneEntry({$phone_entries[i].phs_id});">delete</a> ]
                  {/if}
                </td>
                <td class="default">{$phone_entries[i].phs_type|capitalize}</td>
                <td class="default">{$phone_entries[i].phs_reason}</td>
                <td class="default">{$phone_entries[i].phs_phone_number} ({$phone_entries[i].phs_phone_type})</td>
              </tr>
              {include file="expandable_cell/body.tpl.html" ec_id="phone" list_id=$phone_entries[i].phs_id colspan="6"}
              {sectionelse}
              <tr>
                <td colspan="6" bgcolor="{$light_color}" class="default" align="center">
                  <i>No phone calls recorded yet.</i>
                </td>
              </tr>
              {/section}
            </table>
          </td>
        </tr>
        {if $current_role > $roles.customer || $is_user_assigned == 'true'}
        <tr id="phone_support2" {get_display_style element_name="phone_support"}>
          <td colspan="2" class="default"><b>Record Phone Call:</b></td>
        </tr>
        <tr id="phone_support3" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Date of Call:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            {html_select_date day_value_format='%02d' field_array='date' prefix='' all_extra=' class="default"'}&nbsp;
            {html_select_time minute_interval=5 field_array='date' prefix='' all_extra=' class="default"' display_seconds=false}
            <a href="javascript:void(null);" onClick="javascript:updateTimeFields('add_phone_form', 'date[Year]', 'date[Month]', 'date[Day]', 'date[Hour]', 'date[Minute]');"><img src="images/icons/refresh.gif" border="0"></a>
          </td>
        </tr>
        <tr id="phone_support4" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Reason:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            <select class="default" name="reason">
              <option value="admin">Admin</option>
              <option value="booking">Booking</option>
              <option value="bugfix">Bugfix</option>
              <option value="configure">Configure</option>
              <option value="file transfer">File Transfer</option>
              <option value="imaging">Imaging</option>
              <option value="install">Install</option>
              <option value="meeting">Meeting</option>
              <option value="planning">Planning</option>
              <option value="removal">Removal</option>
              <option value="research">Research</option>
              <option value="service call liaison">Service Call Liaison</option>
              <option value="student support">Student Support</option>
              <option value="tech-support">Tech-Support</option>
              <option value="testing">Testing</option>
              <option value="training">Training</option>
            </select>
          </td>
        </tr>
        <tr id="phone_support5" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Call From:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            <input type="text" class="default" name="from_lname" value="last name" onFocus="javascript:if (this.value == 'last name') this.value='';"><span class="default">,</span>
            <input type="text" class="default" name="from_fname" value="first name" onFocus="javascript:if (this.value == 'first name') this.value='';">
          </td>
        </tr>
        <tr id="phone_support6" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Call To:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            <input type="text" class="default" name="to_lname" value="last name" onFocus="javascript:if (this.value == 'last name') this.value='';"><span class="default">,</span>
            <input type="text" class="default" name="to_fname" value="first name" onFocus="javascript:if (this.value == 'first name') this.value='';">
          </td>
        </tr>
        <tr id="phone_support7" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Type:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            <select class="default" name="type">
              <option value="incoming">Incoming</option>
              <option value="outgoing">Outgoing</option>
            </select>
          </td>
        </tr>
        <tr id="phone_support8" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Customer Phone Number:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            <input type="text" size="20" maxlength="32" name="phone_number" class="default">
            {include file="error_icon.tpl.html" field="phone_number"}
            <select class="default" name="phone_type">
              <option value="office">Office</option>
              <option value="home">Home</option>
              <option value="mobile">Mobile</option>
              <option value="temp">Temp Number</option>
              <option value="other">Other</option>
            </select>
          </td>
        </tr>
        <tr id="phone_support9" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Time Spent:</b></td>
          <td bgcolor="{$light_color}" width="100%"><input type="text" size="5" name="call_length" class="default"> {include file="error_icon.tpl.html" field="call_length"} <span class="default">(in minutes)</span></td>
        </tr>
        <tr id="phone_support10" {get_display_style element_name="phone_support"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Description:</b></td>
          <td bgcolor="{$light_color}">
            <textarea name="description" rows="8" style="width: 97%"></textarea>
            {include file="error_icon.tpl.html" field="description"}
            <span class="small_default"><i>(internal only; not visible to customers)</i></span>
          </td>
        </tr>
		{if $current_role > $roles.viewer || $is_user_assigned == 'true'}
        <tr id="phone_support11" {get_display_style element_name="phone_support"}>
          <td colspan="2" bgcolor="{$internal_color}" align="center">
            <input type="submit" value="Save Phone Call" class="button">
          </td>
        </tr>
        {/if}
        {/if}
      </table>
    </td>
  </tr>
</form>
</table>
<script language="JavaScript">
<!--
updateTimeFields('add_phone_form', 'date[Year]', 'date[Month]', 'date[Day]', 'date[Hour]', 'date[Minute]');
//-->
</script>

