
<script language="JavaScript">
<!--
//var page_url = '{$smarty.server.PHP_SELF}';
//var current_page = {$details_info.current_page};
//var last_page = {$details_info.last_page};
{$najax_register}
var rel_url = '{$rel_url}';
var max_width = {$smarty.const.APP_IMAGE_PREVIEW_MAX_WIDTH};
var max_height = {$smarty.const.APP_IMAGE_PREVIEW_MAX_HEIGHT};
{literal}

var image_preview_loading = 0;
var image_preview_current_id = '';

// get an image and put it in the preview image
function loadPreview(pid,datastreamID, alt)
{
    if (image_preview_loading > 0) {
        return;
    }
    image_preview_loading = 1;
    pv_img = document.getElementById('datastream_preview');
    pv_img_href = document.getElementById('datastream_preview_href');    
    // display the 'loading...' text. (unhide it)
    pv_loading = document.getElementById('datastream_preview_loading');
    pv_loading.innerHTML = ' - Loading...';
    pv_loading.style.display = '';
    // get the resized image
/*    ip_obj = new NajaxImagePreview();
    ip_obj.onGetPreviewError = function () {
        pv_loading.innerHTML = ' - Couldn\'t load preview';
        image_preview_loading = 0;
        pv_img.alt = 'Image Preview';
    };
    ip_obj.setTimeout(100000);
    ip_obj.getPreview(pid, datastreamID, max_width, max_height, false, function() { */
//            pv_img.src = rel_url+'webservices/image_resize_cache.php?pid='+pid+'&dsID='+datastreamID+'&width='+max_width+'&height='+max_height;
            pv_img.src = rel_url+'eserv/'+pid+'/preview_'+datastreamID;
			pv_img_href.href = rel_url+'eserv/'+pid+'/'+datastreamID;
            pv_img.alt = alt;
            pv_loading.style.display = 'none';
            image_preview_loading = 0;
            if (image_preview_current_id.length > 0) {
              tr_list = document.getElementById(image_preview_current_id);
              tr_list.style.backgroundColor='{/literal}{$light_color}{literal}';
            }
            tr_list = document.getElementById('datastream_list_'+alt);
            tr_list.style.backgroundColor='{/literal}{$selected_color}{literal}';
            image_preview_current_id = 'datastream_list_'+alt;
//            });
    
}


function assignItems(f)
{
    if (!hasOneChecked(f, 'item[]')) {
        alert('Please choose which entries to assign.');
        return false;
    }
    if (f.users.options[f.users.selectedIndex].value == '') {
        alert('Please choose the user to assign these entries to.');
        f.users.focus();
        selectField(f, 'users');
        return false;
    }
    var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('', '_popup', features);
    popupWin.focus();
    f.action = 'popup.php';
    f.target = '_popup';
    f.submit();
}
function hideClosed(f)
{
    if (f.hide_closed.checked) {
        window.location.href = page_url + "?" + replaceParam(window.location.href, 'hide_closed', '1');
    } else {
        window.location.href = page_url + "?" + replaceParam(window.location.href, 'hide_closed', '0');
    }
}
function resizePager(f)
{
	var pagesize = f.page_size.options[f.page_size.selectedIndex].value;   
	var temp = replaceParam(window.location.href, 'rows', pagesize);
	temp = replaceParam(page_url + "?" + temp, 'pager_row', '0');
	window.location.href = page_url + "?" + temp;
}
function checkPageField(ev)
{
    // check if the user is trying to submit the form by hitting <enter>
    if (((window.event) && (window.event.keyCode == 13)) ||
            ((ev) && (ev.which == 13))) {
        return false;
    }
}
function goPage(f, new_page)
{
    if ((new_page > last_page+1) || (new_page <= 0) ||
            (new_page == current_page+1) || (!isNumberOnly(new_page))) {
        f.page.value = current_page+1;
        return false;
    }
    setPage(new_page-1);
}
function setPage(new_page)
{
    if ((new_page > last_page) || (new_page < 0) ||
            (new_page == current_page)) {
        return false;
    }
    window.location.href = page_url + "?" + replaceParam(window.location.href, 'pagerRow', new_page);
}
function downloadCSV()
{
    var f = this.document.csv_form;
    f.submit();
    return false;
}
//window.onload = disableFields;
function disableFields()
{
    var f = document.details_form;
    if (current_page == 0) {
        f.first.disabled = true;
        f.previous.disabled = true;
    }
    if ((current_page == last_page) || (last_page <= 0)) {
        f.next.disabled = true;
        f.last.disabled = true;
    }
    if ((current_page == 0) && (last_page <= 0)) {
        f.page.disabled = true;
        f.go.disabled = true;
    }
}

function validateForm(f)
{
    return true;
}
function openHistory(pid)
{
    var features = 'width=520,height=400,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('{/literal}{$rel_url}{literal}history.php?pid=' + pid, '_impact', features);
    popupWin.focus();
}
//-->
</script>
{/literal}
<table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
    <td>
    <table bgcolor="#FFFFFF" width="100%" cellspacing="0" cellpadding="0" border="0">
    <tr>
    <td width="50%" valign="top">
      <input type="hidden" name="cat" value="assign">
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="1" border="0">

        <tr>
          <td align="left" class="default" colspan="2"><br /><img align="absmiddle" src="{$rel_url}images/record_view_32.jpg"/> <b>View {$xdis_title}: <i>{$title}</i> </b> <br /><br /></td>
        </tr>

{if $isUser && !$hide_edit}
{if $isEditor || $isAdministrator}
		<tr>
		  <td align="left"> 
			<table bgcolor="#FFFFFF" border="0" cellspacing="0" cellpadding="1">

		<tr>
		 <td align="left" class="default" nowrap> <b>Workflows:</b></td>		
          <td align="left" class="default" nowrap> &nbsp;
			  {section name="w" loop=$workflows}
			    {if $workflows[w].wft_id != ''}
			    {if $workflows[w].wft_icon == 'images/security.gif'}
			      {if $list[i].security == 'include'}
			        {assign var="wf_icon" value="images/security_include.gif"}
			      {elseif $list[i].security == 'exclude'}
			        {assign var="wf_icon" value="images/security_exclude.gif"}
			      {elseif $list[i].security == 'inherit'}
		                {assign var="wf_icon" value="images/security_inherit.gif"}
			      {else}
			        {assign var="wf_icon" value=$workflows[w].wft_icon}
			      {/if}
		            {else}
			      {assign var="wf_icon" value=$workflows[w].wft_icon}
			    {/if}
                            {if $workflows[w].wft_type_id == 6}
                              {assign var='wf_url' value=$rel_url|cat:'workflow/export.php'}
                            {else}
                              {assign var='wf_url' value=$rel_url|cat:'workflow/update.php'}
			    {/if}
			<a href='{$wf_url}?pid={$pid|escape:"html"}&cat=select_workflow&xdis_id={$xdis_id}&wft_id={$workflows[w].wft_id}&href={$smarty.server.REQUEST_URI}'><img title="{$workflows[w].wfl_title}" align="absmiddle" src="{$rel_url}{$wf_icon}" border="0"></a> 
				{/if}
			  {/section}
			<a href="workflow/list_workflows2.php?pid={$pid|escape}"><img src="{$rel_url}images/options_16.png" align="absmiddle" alt="More options" title="More options" border="0" width="16" height="16" /></a>             
			</td>
		</tr>
		</table>
	  </td>
	</tr>
{/if}
{/if}
{if $show_tombstone && !$deleted || !$show_tombstone}
		<tr>
		  <td align="left"> 
			<table bgcolor="#FFFFFF" border="0" cellspacing="0" cellpadding="2" width="100%">
 		       {if $citation != ""}
				<tr valign="top">
				  <td align="left" class="citation"> <b>Citation:</b></td>
				  <td align="left" class="citation" width="100%"> {$citation}
				  </td>
				</tr>
                {/if}
				{if $parents}
				<tr>
				  <td align="left" class="default"> <b>{$parent_heading} </b></td>
				  <td align="left" class="default" width="100%"> 
					{section name="i" loop=$parents}
						<a href="{$rel_url}list.php?collection_pid={$parents[i].rek_pid}">{$parents[i].rek_title}</a> &nbsp;
					{/section}
				  </td>
				</tr>
				{/if}
{if $prev || $next}
				<tr valign="top">
				  <td align="left" class="default" nowrap> <b>Browse Collection:</b></td>
				  <td align="left" class="default" width="100%"> 
{if $prev}<a href="{$rel_url}view/{$prev.rek_pid}&go_prev={$go_prev}">Prev: <i>{$prev.rek_title}</i></a> {if $next}<br />{/if}{/if}
{if $next}<a href="{$rel_url}view/{$next.rek_pid}&go_next={$go_next}">Next: <i>{$next.rek_title}</i></a> {/if}
				  </td>
				</tr>
{/if}
{if $fileCount > 0}
			</table>
		  </td>
		</tr> 
		<tr>
		  <td align="left"> 
			<table bgcolor="#FFFFFF" border="0" cellspacing="0" cellpadding="2" width="100%">

		  <tr>
			<td class="default" colspan="5">&nbsp;</td>
		  </tr>
		  <tr>
			<td class="default_white" colspan="5" bgcolor="{$heading_color}"><b>Attached Files</b></td>
		  </tr>

		  <tr class="default" bgcolor="{$cell_color}">
			<td>Name</td>
			<td>Description</td>			
			<td>MIMEType</td>
			<td>Size</td>			
			<td align="right">Downloads</td>			
		  </tr>

		{assign var="show_preview_pane" value="0"}
        {section name="d" loop=$datastreams}
			{if $datastreams[d].controlGroup == "M" && $datastreams[d].isLister == 1}
  			  <tr class="default" id="datastream_list_{$datastreams[d].ID}" bgcolor="{$light_color}"> 			  
				{assign var="image_file_name" value=$datastreams[d].MIMEType|replace:"/":"_"|cat:".png"}
				{assign var="image_name" value=$fez_root_dir|cat:"images/"|cat:$image_file_name} 			
				{if ($datastreams[d].canPreview || $isAdministrator) && !$preview_ds_1 && $datastreams[d].preview != "0"}
				  {assign var="preview_ds_1" value=$datastreams[d]}
				{/if}
				{assign var="image_file_string" value=""}
				{fetch file=$image_name assign="image_file_string"}
				<td nowrap>
            {if $datastreams[d].thumbnail != "0"}{if $datastreams[d].canPreview || $isAdministrator}<a href="#">{/if}
				{assign var="show_preview_pane" value="1"}
			<img align="absmiddle" title="Click on the thumbnail image to show the corresponding preview image" src="{$eserv_url}{$datastreams[d].thumbnail}" border="1"
            {if $datastreams[d].canPreview || $isAdministrator}onclick="javascript:loadPreview('{$pid}','{$datastreams[d].preview}', '{$datastreams[d].ID|escape:'html'}');"{/if}
            >{if $datastreams[d].canPreview || $isAdministrator}</a>{/if}{/if}{if $image_file_string != ""}<img align="absmiddle" src="{$rel_url}images/{$image_file_name}">{else}<img align="absmiddle" src="{$rel_url}images/default.png">{/if} {if $datastreams[d].isViewer == 1 || $isAdministrator}<a target="_blank" href="{$rel_url}eserv/{$pid}/{$datastreams[d].ID}">{/if}{$datastreams[d].ID}{if $datastreams[d].isViewer == 1 || $isAdministrator}</a> &nbsp;{/if} {if ($datastreams[d].isArchivalViewer == 1 || $isAdministrator) && $datastreams[d].thumbnail != "0"}<a target="_blank" href="{$rel_url}eserv/{$pid}/archival_{$datastreams[d].ID}"><img title="archival version" align="absmiddle" border="0" src="{$rel_url}images/archival_22.gif"></a>&nbsp;{/if} {if $datastreams[d].presmd != "0" && ($isAdministrator)}<a target="_blank" href="{$rel_url}eserv/{$pid}/{$datastreams[d].presmd}"><img title="preservation metadata" align="absmiddle" border="0" src="{$rel_url}images/presmd_22.gif"></a>&nbsp;{/if} 	
				</td>
				<td>{$datastreams[d].label}</td>
				<td>{$datastreams[d].MIMEType}</td>
				<td>{$datastreams[d].archival_size}</td>				
				<td align="right">{$datastreams[d].downloads}</td>				
			  </tr>
			 {/if}
        {/section}
        

	
    {/if}


			</table><br />
		  </td>
		</tr> 
{if $sta_id != 2}
<tr><td class="error" bgcolor="{$heading_color}" align="center">
<b>NOTE: This record is not published.</b>
</td></tr>
{/if}


                <tr>
                <td>
{include file='view_metadata.tpl.html'}
                </td>
                </tr>
      </table>
		<table width="100%" border="0" cellpadding="2" cellspacing="0"  bgcolor="#FFFFFF" >

	{if $linkCount > 0}
		  <tr>
			<td class="default" colspan="5">&nbsp;</td>
		  </tr>
		  
		  <tr>
			<td class="default_white" colspan="5" bgcolor="{$heading_color}"><b>Related Links</b></td>
		  </tr>

		  <tr class="default">
			<td colspan="2" bgcolor="{$cell_color}">Link</td>
			<td colspan="3" bgcolor="{$cell_color}">Description</td>
		  </tr>
{if $doi}
<tr>
<td class="default" bgcolor="{$light_color}" colspan="2">
<a target="_blank" href="{$doi.location}">{$doi.location}</a> 
</td>
<td class="default" bgcolor="{$light_color}" colspan="3">{$doi.label}</td>
</tr>

{/if}

        {section name="d" loop=$datastreams}        
			{if $datastreams[d].controlGroup == "R" && $datastreams[d].ID != "DOI"}
			  <tr class="default"> 
				<td colspan="2" bgcolor="{$light_color}"><img align="absmiddle" src="{$rel_url}images/text_html.png"> <a target="_blank" href="{$datastreams[d].location}">{$datastreams[d].location}</a> &nbsp;</td>
				<td colspan="3" bgcolor="{$light_color}">{$datastreams[d].label} &nbsp;</td>
			  </tr>
			 {/if}
        {/section}
    {/if}
	{if $hasVersions == 1}		  
		  <tr>
			<td class="default" colspan="5">&nbsp;</td>
		  </tr>
		  <tr>
			<td class="default_white" colspan="5" bgcolor="{$heading_color}"><b>Available Versions of this Record</b></td>
		  </tr>

		  <tr class="default">
			<td colspan="5" bgcolor="{$cell_color}">{$derivationTree}</td>
		  </tr>
	{/if}		  
		  
		  
		  <tr>
			<td class="default" colspan="5">&nbsp;</td>
		  </tr>    
		  
{else}
	{* Show tombstone *}
		<tr>
			<td>
				<div class="outline light_background">
				<div class="admin-header">This record has been deleted.</div>
				{if $duplicate_pid}
					<div  class="admin-content">
					<div>It was marked as a duplicate of <a href="{$rel_url}view/{$duplicate_pid}">{$duplicate_pid}</a></div>
					<div>Event detail: {$duplicate_premis.pre_detail}</div>
					<div>Date: {$duplicate_premis.pre_date|date_format:'%a, %d %b %Y, %H:%M:%S %z'}</div>
					</div>
				{/if}
				</div>
			</td>
		</tr>
{/if}
		  
		  
		  <tr>
			<td align="left" colspan="5">
		<table width="100%" border="0" cellpadding="2" cellspacing="0"  bgcolor="#FFFFFF" >  
{if $WEBSERVER_LOG_STATISTICS == 'ON'}   		
				<tr>
				  <td align="left" class="default" nowrap> <b>Access Statistics:</b></td>
				  <td align="left" class="default" nowrap width="100%">  {$statsAbstract} Abstract Views{if $fileCount > 0}, {$statsFiles} File Downloads{/if}
				  <a href="{$rel_url}stat_details.php?action=show_detail&pid={$pid}">Detailed Statistics</a>
				  </td>
				</tr>
{/if}				
				<tr>
				  <td align="left" class="default" nowrap> <b>Created:</b></td>
				  <td align="left" class="default" nowrap width="100%">  {$created_date} 
				  {if $depositor != ""} by <a href="{$rel_url}list.php?browse=depositor&depositor={$depositor_id}" class="silent_link">{$depositor}</a>.{/if}
				  <a title="view the full history of changes on this object" href="javascript:void(null);" onclick="javascript:openHistory('{$pid}');">Detailed History</a>
			  </td>
				</tr>

		</table>
			</td>		
		  </tr>
    
	    </table>
		
    </td>
{if $show_tombstone && !$deleted || !$show_tombstone}
	{if $show_preview_pane == "1"} 
    <td align="center" valign="top"  bgcolor="#FFFFFF" cellspacing="1" cellpadding="2" border="0">
      <table width="100%" border="0" cellpadding="2" cellspacing="0"  bgcolor="#FFFFFF" >
        <tr>
          <td class="default_white" colspan="4" bgcolor="{$heading_color}"><b>Image Preview (click the image for a larger version)</b>
          <span id="datastream_preview_loading" style="display:none;"></span>
          </td>
        </tr>
        <tr>
        <td class="default">
          {if $preview_ds_1}
          <a id="datastream_preview_href" title="Click on the image to see a larger version"  target="_blank" href="{$rel_url}eserv/{$pid}/{$preview_ds_1.ID}"><img border=0 id="datastream_preview" alt="Datastream Preview"/></a>
          <script language="JavaScript">loadPreview('{$pid}','{$preview_ds_1.preview}','{$preview_ds_1.ID|escape:'html'}');</script>
          {/if}
        </td>
        </tr>
      </table>
    </td>
	{/if}
{/if}
  </tr>			
  </table>
  </td>
  </tr>

</table>

