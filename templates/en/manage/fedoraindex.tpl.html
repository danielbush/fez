
      <table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
        <tr>
          <td>
            <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">

<script type="text/javascript">
<!--
{$najax_register}
{literal}
var coll_load_state = 0;

function showLoading()
{
    document.body.style.cursor = 'wait';
    document.getElementById('loading').style.display = 'block';
};

function hideLoading()
{
    document.body.style.cursor = '';
    document.getElementById('loading').style.display = 'none';
};


function selectCommunity(f, field_name)
{
    if (coll_load_state > 0) {
       return false;
    } 
    var field = getFormElement(f, field_name);
    var selections = getSelectedItems(field);

    if (selections.length > 0) {
        coll_load_state++;
        document.getElementById('tr_collection_pid').style.display = '';
        showLoading();
        var obj = new SelectReindexInfo();
        obj.onGetCollectionsError = function() {
            removeAllOptions(f, 'collection_pid');
            hideLoading();
            coll_load_state--;
        }
        obj.setTimeout(10000);
        obj.getCollections(selections[0].value, function(collections_list) {
                removeAllOptions(f, 'collection_pid');
                addOptions(f, 'collection_pid', collections_list);
                hideLoading();
                coll_load_state--;
                selectCollection(f, 'collection_pid'); 
                });
    }
}

var dt_load_state = 0;
function showLoading1()
{
    document.body.style.cursor = 'wait';
    document.getElementById('loading1').style.display = 'block';
}

function hideLoading1()
{
    document.body.style.cursor = '';
    document.getElementById('loading1').style.display = 'none';
}

function selectCollection(f, field_name)
{
    if (dt_load_state > 0) {
       return false;
    } 
    var field = getFormElement(f, field_name);
    var selections = getSelectedItems(field);

    if (selections.length > 0) {
        dt_load_state++;
        document.getElementById('tr_xdis_id').style.display = '';
        showLoading1();
        var obj = new SelectReindexInfo();
        obj.onGetDocTypesError = function() {
            removeAllOptions(f, 'xdis_id');
            hideLoading1();
            dt_load_state--;
        }
        obj.setTimeout(10000);
        obj.getDocTypes(selections[0].value, function(dt_list) {
                removeAllOptions(f, 'xdis_id');
                addOptions(f, 'xdis_id', dt_list);
                hideLoading1();
                dt_load_state--;
                });
    }
}

{/literal}
// -->
</script>
              <tr>
                <td colspan="2" class="default">
                  <b>Index Fedora Objects into Fez</b>
                </td>
              </tr>
             <tr>
                <td bgcolor="{$light_color}" class="default">
                This is a list of items in the fedora database that are not indexed in the 
                fez database. Check the boxes next to the objects you want Fez to index and click 'Index Into Fez'.
                </td>
              </tr>
		  <tr>
			<td>
			  <table>
                    <form name="reindex_form" onSubmit="javascript:return checkDelete(this);" method="post" action="{$smarty.server.PHP_SELF}">
			<tr>
			  <td class="default" colspan="2">
				<b><img align="absmiddle" src="{$rel_url}images/collection.jpg" border="0"> &nbsp; Select Destination Collection</b>
			  </td>
			</tr>			
			<tr>
			  <td  bgcolor="{$cell_color}" class="default" nowrap>
				<b>Parent Community</b>
			  </td>
			  <td width="75%" bgcolor="{$light_color}">
				<select class="default" name="community_pid" onChange="javascript: selectCommunity(this.form, 'community_pid')" >
				  {html_options options=$communities_list selected=$communities_list_selected }
				</select>
			  </td>
			</tr>
			<tr style="display:none;" id="tr_collection_pid">
			  <td bgcolor="{$cell_color}" class="default">
				<b>Collection</b>
			  </td>
			  <td bgcolor="{$light_color}">
				<div id="loading" style="display:none;">Loading...</div>
				<select class="default" name="collection_pid" onChange="javascript: selectCollection(this.form, 'collection_pid')">
				</select>
			  </td>
			</tr>
				
			<tr style="display:none;" id="tr_xdis_id">
			  <td bgcolor="{$cell_color}" class="default">
				<b>Document Type</b>
			  </td>
			  <td bgcolor="{$light_color}">
				<div id="loading1" style="display:none;">Loading...</div>
				<select class="default" name="xdis_id">
				</select>
			  </td>
			</tr>
			<tr>
			  <td bgcolor="{$cell_color}" class="default">
				<b>Publishing Status</b>
			  </td>
			  <td bgcolor="{$light_color}">
				<select class="default" name="sta_id">
					 {html_options options=$status_list}
				</select>
			  </td>
			</tr>			
			<script type="text/javascript"><!-- 
			selectCommunity(getForm('reindex_form'), 'community_pid'); 
			// --></script>
				  </table>
				</td>
 			  </tr>			
			  <tr>
			  	<td>
                  <table border="0" width="100%" cellpadding="1" cellspacing="1">

		            <input type="hidden" name="cat" value="go">        
                    <tr>
                      <td width="5" bgcolor="{$cell_color}" nowrap><input type="button" value="All" class="shortcut" onClick="javascript:toggleSelectAll(this.form, 'items[]');"></td>
                      <td width="10%" bgcolor="{$cell_color}" class="default">&nbsp;<b>PID</b>&nbsp;</td>
                      <td width="40%" bgcolor="{$cell_color}" class="default">&nbsp;<b>Title</b>&nbsp;</td>
                      <td width="50%" bgcolor="{$cell_color}" class="default" nowrap>&nbsp;<b>Description</b>&nbsp;</td>
                    </tr>
                    {section name="i" loop=$list}
                    {cycle values=$cycle assign="row_color"}
                    <tr>
                      <td width="4" nowrap bgcolor="{$row_color}" align="center">
                        <input type="checkbox" name="items[]" value="{$list[i].pid}" {if $smarty.section.i.total == 0}disabled{/if}>
                      </td>
                      <td bgcolor="{$row_color}" class="default">
                        &nbsp;{$list[i].pid}
                      </td>
                      <td bgcolor="{$row_color}" class="default">
                        &nbsp;{$list[i].title}
                      </td>
                      <td bgcolor="{$row_color}" class="default">
                        &nbsp;{$list[i].description}
                      </td>
                    </tr>
                    {sectionelse}
                    <tr>
                      <td colspan="4" bgcolor="{$light_color}" align="center" class="default">
                        No Fedora objects missing from the Fez Index could be found.
                      </td>
                    </tr>
                    {/section}
                    <tr>
                      <td width="2" align="center" bgcolor="{$cell_color}">
                        <input type="button" value="All" class="shortcut" onClick="javascript:toggleSelectAll(this.form, 'items[]');">
                      </td>
                      <td colspan="3" align="center" bgcolor="{$cell_color}">
                        <input type="submit" value="Index Into Fez" class="button">
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
	  </form>
<script type="text/javascript"><!-- 
selectCommunity(getForm('wfl_form1'), 'community_pid'); 
// --></script>	  

