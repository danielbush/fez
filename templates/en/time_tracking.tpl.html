
{literal}

<script language="JavaScript">
<!--
function validateTimeForm(f)
{
    if (isWhitespace(f.summary.value)) {
        alert('Please enter the summary for this new time tracking entry.');
        selectField(f, 'summary');
        return false;
    }
    if (f.category.options[f.category.selectedIndex].value == '') {
        alert('Please choose the time tracking category for this new entry.');
        selectField(f, 'category');
        return false;
    }
    if (!hasOneSelected(f, 'assignments[]')) {
        alert('Please select an assignment for this timetracking entry');
        selectField(f, 'assignments[]');
        return false;
    }

    if ((isWhitespace(f.time_spent.value)) || (!isNumberOnly(f.time_spent.value))) {
        alert('Please enter integers (or floating point numbers) on the time spent field.');
        selectField(f, 'time_spent');
        return false;
    }
    var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('', '_time', features);
    popupWin.focus();
    return true;
}

function deleteTimeEntry(time_id)
{
    if (!confirm('This action will permanently delete the specified time tracking entry.')) {
        return false;
    } else {
        var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
        var popupWin = window.open('popup.php?cat=delete_time&id=' + time_id, '_popup', features);
        popupWin.focus();
    }
}
//-->
</script>
{/literal}
<br />
<table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
<form name="add_time_form" onSubmit="javascript:return validateTimeForm(this);" target="_time" method="post" action="{$rel_url}popup.php">
<input type="hidden" name="cat" value="add_time">
<input type="hidden" name="issue_id" value="{$smarty.get.id}">
  <tr>
    <td width="100%">
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2">
        <tr>
          <td class="default" nowrap>
            <b>Time Tracking ({$time_entries|@count})</b>
          </td>
          <td align="right" class="default">
            {if $browser.ie5up or $browser.ns6up or $browser.gecko}
            [ <a id="time_tracker_link" class="link" href="javascript:void(null);" onClick="javascript:toggleVisibility('time_tracker');">{get_innerhtml element_name="time_tracker"}</a> ]
            {/if}
          </td>
        </tr>
        <tr id="time_tracker1" {get_display_style element_name="time_tracker"}>
          <td colspan="2" class="default" width="100%">
            <table width="100%" cellpadding="2" cellspacing="1">
              <tr bgcolor="{$internal_color}">
                <td valign="top" class="default_white">Date of Work</td>
                <td valign="top" class="default_white">User</td>
                <td valign="top" class="default_white">Time Spent</td>
                <td valign="top" class="default_white">Category</td>
                <td valign="top" width="50%" class="default_white">Summary</td>
                <td valign="top" class="default_white">Team</td>
              </tr>
              {section name="i" loop=$time_entries}
              {cycle values=$cycle assign="row_color"}
              <tr bgcolor="{$row_color}">
                <td valign="top" class="default">{$time_entries[i].ttr_created_date}</td>
                <td valign="top" class="default">
                  {$time_entries[i].usr_full_name}
                  [ <a class="link" href="javascript:void(null);" onClick="javascript:deleteTimeEntry({$time_entries[i].ttr_id});">delete</a> ]
                </td>
                <td valign="top" class="default">{$time_entries[i].formatted_time}</td>
                <td valign="top" class="default">{$time_entries[i].ttc_title}</td>
                <td valign="top" class="default">{$time_entries[i].ttr_summary}</td>
                <td valign="top" class="default">{$time_entries[i].prj_title}</td>
              </tr>
              {if $smarty.section.i.last}
              <tr>
                <td bgcolor="{$internal_color}" colspan="2" class="default_white" align="right">Total Time Spent:</td>
                <td bgcolor="{$dark_color}" colspan="4" class="default">{$total_time_spent}</td>
              </tr>
              {/if}
              {sectionelse}
              <tr>
                <td colspan="6" bgcolor="{$light_color}" align="center" class="default">
                  <i>No time tracking entries could be found.</i>
                </td>
              </tr>
              {/section}
            </table>
          </td>
        </tr>
        {if $current_role > $roles.viewer || $is_user_assigned == 'true'}
        <tr id="time_tracker2" {get_display_style element_name="time_tracker"}>
          <td colspan="2" class="default"><b>Record Time Worked:</b></td>
        </tr>
        <tr id="time_tracker3" {get_display_style element_name="time_tracker"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Summary:</b></td>
          <td bgcolor="{$light_color}" width="100%"><textarea rows="12" cols="100" class="default" name="summary" size="40"></textarea>{include file="error_icon.tpl.html" field="summary"}</td>
        </tr>

		<tr id="time_tracker8" {get_display_style element_name="time_tracker"}>
          <td width="120" bgcolor="{$cell_color}" class="default_white">
            <b>Users:</b><br /> (person(s) who spent time)
          </td>
          <td bgcolor="{$light_color}" >
            <input type="hidden" name="keep_assignments" value="no">
            <select size="{if $issue.has_inactive_users}3{else}4{/if}" multiple class="default" name="assignments[]" onChange="javascript:showSelections('add_time_form', 'assignments[]');">
              {if $issue.has_inactive_users}
              {html_options options=$users}
              {else}
              {html_options options=$users selected=$user_id}
              {/if}
            </select><input type="button" class="shortcut" value="Clear Selections" onClick="javascript:clearSelectedOptions(getFormElement(this.form, 'assignments[]'));showSelections('add_time_form', 'assignments[]');"><br />
            <div class="default" id="selection_assignments[]">{if $user_fullname}Current Selections: {$user_fullname}{/if}</div>
          </td>
		</tr>
        <tr id="time_tracker4" {get_display_style element_name="time_tracker"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Category:</b></td>
          <td bgcolor="{$light_color}" width="100%"> 
            <select name="category" class="default">
              <option value="">Please choose a category</option>
              {html_options options=$time_categories}
            </select>
            {include file="error_icon.tpl.html" field="category"}
          </td>
        </tr>
        <tr id="time_tracker5" {get_display_style element_name="time_tracker"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Time Spent:</b></td>
          <td bgcolor="{$light_color}" width="100%"><input class="default" type="text" size="5" name="time_spent" class="default"> <span class="default">(in minutes)</span>{include file="error_icon.tpl.html" field="time_spent"}</td>
        </tr>
        <tr id="time_tracker6" {get_display_style element_name="time_tracker"}>
          <td bgcolor="{$internal_color}" class="default_white" width="190" nowrap><b>Date of Work:</b></td>
          <td bgcolor="{$light_color}" width="100%">
            {html_select_date day_value_format='%02d' field_array='date' prefix='' all_extra=' class="default"'}&nbsp;
            {html_select_time minute_interval=5 field_array='date' prefix='' all_extra=' class="default"' display_seconds=false}
            <a href="javascript:void(null);" onClick="javascript:updateTimeFields('add_time_form', 'date[Year]', 'date[Month]', 'date[Day]', 'date[Hour]', 'date[Minute]');"><img src="images/icons/refresh.gif" border="0"></a>
          </td>
        </tr>
        <tr id="time_tracker7" {get_display_style element_name="time_tracker"}>
          <td colspan="2" bgcolor="{$internal_color}" align="center" width="100%" nowrap>
            <input type="submit" value="Clock-In" class="button">
          </td>
        </tr>
        {/if}
      </table>
    </td>
  </tr>
</form>
</table>
<script language="JavaScript">
<!--
updateTimeFields('add_time_form', 'date[Year]', 'date[Month]', 'date[Day]', 'date[Hour]', 'date[Minute]');
//-->
</script>

